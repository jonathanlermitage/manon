### MAIN CONFIGURATION ###  (warning: avoid tabs, indent with two spaces)
# see https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html

spring:
  http.converters.preferred-json-mapper: jackson
  batch:
    initialize-schema: always
    job.enabled: false
  main.banner-mode: console
  datasource:
    username: ${MANON_SQL_USERNAME:}
    password: ${MANON_SQL_PASSWORD:}
    url: ${MANON_SQL_JDBC_URL:}
    driver-class-name: ${MANON_SQL_DRIVER_CLASSNAME:org.mariadb.jdbc.Driver}
  data:
    jpa.repositories.bootstrap-mode: deferred
    redis.repositories.enabled: false
  jpa:
    hibernate.ddl-auto: validate
    open-in-view: false
  flyway.baseline-on-migrate: true
  redis:
    database: ${MANON_REDIS_DATABASE:0}
    host: ${MANON_REDIS_HOST:""}
    port: ${MANON_REDIS_PORT:0}
  pid:
    fail-on-write-error: true
    file: manon.pid
  output.ansi.enabled: always
server:
  compression.enabled: false # compression is handled by Nginx proxy
  servlet.application-display-name: manon
  ssl.enabled: false # encryption is handled by Nginx proxy
  undertow.accesslog.enabled: false
  servlet.context-path: "/"

info.app:
  name: manon
  version: @project.version@

management:
  endpoint:
    configprops.enabled: true
    env.enabled: true
    health:
      enabled: true
      show-details: when_authorized
      roles: "ROLE_ACTUATOR"
    info.enabled: true
    mappings.enabled: true
    metrics.enabled: true
    scheduledtasks.enabled: true
  endpoints:
    enabled-by-default: false
    web:
      base-path: /actuator
      exposure.include: ["configprops", "env", "health", "info", "metrics", "scheduledtasks"]
  health.redis.enabled: ${MANON_REDIS_MANAGEMENT:false}

manon:
  cache:
    provider: ${MANON_CACHE_PROVIDER:embedded}
    redis.ttl: 7200s
  default-user:
    actuator:
      username: ${MANON_ACTUATOR_USERNAME:ACTUATOR}
      password: ${MANON_ACTUATOR_PASSWORD:woot}
    admin:
      username: ${MANON_ADMIN_USERNAME:ROOT}
      password: ${MANON_ADMIN_PASSWORD:woot}
  batch:
    user-snapshot:
      chunk: 1000
      snapshot.max-age: 30d
  httpclient:
    connect-timeout: 2s
    read-timeout: 2s
  performance-recorder.enabled: false
  security:
    bcrypt.strength: 6
    jwt:
      issuer: ${MANON_JWT_ISSUER:default_issuer}
      signing-key-b64: ${MANON_JWT_SIGNINGKEYB64:NDlEM3JweG5TcFY3TXg2eSEyNkJmMmNRV2VEQXZQNWdRQU1CUlZTdURHeT9SZzUyQ0FuTnAqKl8tLTdIcw==}
      token-ttl: ${MANON_JWT_TOKENTTL:7200s}
